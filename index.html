<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š æˆæƒæ•°é‡å°æ—¶åˆ†å¸ƒå›¾ </title>
    <!-- å¼•å…¥SheetJSåº“ç”¨äºè¯»å–Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h1 small {
            font-size: 16px;
            color: #666;
            font-weight: normal;
            margin-left: auto;
        }
        
        .upload-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .upload-label {
            display: inline-block;
            padding: 15px 40px;
            background: white;
            color: #667eea;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 2px solid transparent;
        }
        
        .upload-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            background: #f0f0f0;
        }
        
        .upload-label i {
            margin-right: 10px;
        }
        
        #fileInput {
            display: none;
        }
        
        .file-info {
            margin-top: 15px;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .data-info {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(67, 233, 123, 0.3);
        }
        
        .date-section {
            background: #f8f9ff;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .section-title {
            font-size: 18px;
            color: #555;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: 15px;
        }
        
        .date-btn {
            padding: 12px 24px;
            border: none;
            background: white;
            color: #667eea;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 2px solid transparent;
        }
        
        .date-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            background: #667eea;
            color: white;
        }
        
        .date-btn.active {
            background: #667eea;
            color: white;
            border-color: #fff;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 25px;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            font-size: 42px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 5px;
        }
        
        .stat-unit {
            font-size: 14px;
            opacity: 0.7;
        }
        
        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            position: relative;
            height: 500px;
            min-height: 400px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 50px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #555;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 6px;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #999;
            font-size: 14px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .update-time {
            color: #667eea;
            font-weight: 600;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #999;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .date-buttons {
                justify-content: center;
            }
            
            .stat-value {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>
            ğŸ“ˆ æˆæƒæ•°é‡å°æ—¶åˆ†å¸ƒå›¾
            <!-- <small>ç›´æ¥è¯»å–Excelæ–‡ä»¶</small> -->
        </h1>
        
        <div class="upload-section">
            <label for="fileInput" class="upload-label">
                ğŸ“ ç‚¹å‡»é€‰æ‹©Excelæ–‡ä»¶
            </label>
            <input type="file" id="fileInput" accept=".xlsx, .xls, .csv">
            <div class="file-info" id="fileInfo">
                è¯·ä¸Šä¼ åŒ…å«ç”¨æˆ·IDå’Œæˆæƒæ—¶é—´çš„Excelæ–‡ä»¶
            </div>
        </div>
        
        <div class="data-info" id="dataInfo" style="display: none;">
            <span>ğŸ“Š æ•°æ®èŒƒå›´ï¼š<span id="dateRange">-</span></span>
            <span id="totalRecords">0æ¡è®°å½•</span>
        </div>
        
        <div class="date-section" id="dateSection" style="display: none;">
            <div class="section-title">
                <span>ğŸ“…</span> é€‰æ‹©æ—¥æœŸæŸ¥çœ‹è¯¦ç»†åˆ†å¸ƒ
            </div>
            <div class="date-buttons" id="dateButtons">
                <!-- æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="stats-grid" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">ğŸ“Š æ€»æˆæƒæ•°</div>
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-unit">ç´¯è®¡æ¬¡æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">â° æœ€é«˜å³°æ—¶æ®µ</div>
                <div class="stat-value" id="peakHour">--</div>
                <div class="stat-unit">å…¨å¤©æœ€æ´»è·ƒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ“ˆ æœ€é«˜å³°æ•°é‡</div>
                <div class="stat-value" id="peakCount">0</div>
                <div class="stat-unit">å•å°æ—¶æœ€å¤§</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ“‰ å¹³å‡æ¯å°æ—¶</div>
                <div class="stat-value" id="avgCount">0</div>
                <div class="stat-unit">24å°æ—¶å¹³å‡</div>
            </div>
        </div>
        
        <div class="legend" id="legend" style="display: none;">
            <div class="legend-item">
                <div class="legend-color" style="background: #4A90E2;"></div>
                <span>æˆæƒæ•°é‡æ›²çº¿</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FF6B6B;"></div>
                <span>æœ€é«˜ç‚¹æ ‡è®°</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FFD93D;"></div>
                <span>å¹³å‡å€¼å‚è€ƒçº¿</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(74, 144, 226, 0.1);"></div>
                <span>é¢ç§¯å¡«å……</span>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="loading" id="loading">ğŸ“Š è¯·ä¸Šä¼ Excelæ–‡ä»¶</div>
            <canvas id="hourlyChart"></canvas>
        </div>
        
        <div class="footer">
            <span class="update-time">â±ï¸ å®æ—¶è¯»å–</span> Â· ç‚¹å‡»æ—¥æœŸæŒ‰é’®åˆ‡æ¢æ˜¾ç¤º Â· é¼ æ ‡æ‚¬åœæŸ¥çœ‹è¯¦ç»†æ•°æ® Â· æ”¯æŒ.xlsx/.xls/.csvæ ¼å¼
        </div>
    </div>

    <script>
        let myChart;
        let dailyData = {};
        let dates = [];
        let currentData = [];

        // ç›‘å¬æ–‡ä»¶ä¸Šä¼ 
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('loading').innerHTML = 'ğŸ“Š æ­£åœ¨è¯»å–Excelæ–‡ä»¶...';
            document.getElementById('fileInfo').innerHTML = `å·²é€‰æ‹©: ${file.name}`;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // è½¬æ¢ä¸ºJSON
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    // è§£ææ•°æ®
                    parseExcelData(jsonData);
                    
                } catch (error) {
                    alert('è¯»å–Excelæ–‡ä»¶å¤±è´¥ï¼š' + error.message);
                    document.getElementById('loading').innerHTML = 'âŒ è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•';
                }
            };
            
            reader.readAsArrayBuffer(file);
        });

        // è§£æExcelæ•°æ®
        function parseExcelData(rows) {
            // æ‰¾åˆ°æ ‡é¢˜è¡Œ
            let headerRow = -1;
            let dateCol = -1;
            
            for (let i = 0; i < Math.min(rows.length, 10); i++) {
                const row = rows[i];
                if (!row) continue;
                
                for (let j = 0; j < row.length; j++) {
                    const cell = String(row[j] || '').toLowerCase();
                    if (cell.includes('æˆæƒæ—¶é—´') || cell.includes('æ—¶é—´') || cell.includes('time')) {
                        headerRow = i;
                        dateCol = j;
                        break;
                    }
                }
                if (headerRow !== -1) break;
            }
            
            if (headerRow === -1) {
                alert('æœªæ‰¾åˆ°æˆæƒæ—¶é—´åˆ—ï¼Œè¯·ç¡®ä¿Excelä¸­åŒ…å«"æˆæƒæ—¶é—´"åˆ—');
                return;
            }
            
            // ç»Ÿè®¡æ¯æ—¥æ¯å°æ—¶æ•°æ®
            dailyData = {};
            let validCount = 0;
            
            for (let i = headerRow + 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row || row.length <= dateCol) continue;
                
                const timeStr = String(row[dateCol] || '').trim();
                if (!timeStr) continue;
                
                // è§£ææ—¶é—´
                let date, hour;
                
                // å°è¯•å¤šç§æ—¥æœŸæ ¼å¼
                if (timeStr.includes('T')) {
                    // ISOæ ¼å¼: 2026-02-26T18:00:09
                    const parts = timeStr.split('T');
                    date = parts[0];
                    hour = parseInt(parts[1].split(':')[0]);
                } else if (timeStr.includes('-') && timeStr.includes(':')) {
                    // å¯èƒ½æ ¼å¼: 2026-02-26 18:00:09
                    const parts = timeStr.split(' ');
                    date = parts[0];
                    hour = parseInt(parts[1].split(':')[0]);
                } else {
                    // å°è¯•Excelæ—¥æœŸæ•°å€¼
                    try {
                        const excelDate = parseFloat(timeStr);
                        if (!isNaN(excelDate)) {
                            const jsDate = new Date((excelDate - 25569) * 86400 * 1000);
                            date = jsDate.toISOString().split('T')[0];
                            hour = jsDate.getHours();
                        } else {
                            continue;
                        }
                    } catch {
                        continue;
                    }
                }
                
                if (!date || isNaN(hour)) continue;
                
                if (!dailyData[date]) {
                    dailyData[date] = new Array(24).fill(0);
                }
                
                dailyData[date][hour]++;
                validCount++;
            }
            
            if (validCount === 0) {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„æˆæƒæ—¶é—´æ•°æ®');
                return;
            }
            
            // è·å–æ‰€æœ‰æ—¥æœŸå¹¶æ’åº
            dates = Object.keys(dailyData).sort();
            
            // æ˜¾ç¤ºç•Œé¢å…ƒç´ 
            document.getElementById('dataInfo').style.display = 'flex';
            document.getElementById('dateSection').style.display = 'block';
            document.getElementById('stats').style.display = 'grid';
            document.getElementById('legend').style.display = 'flex';
            
            // æ›´æ–°æ—¥æœŸèŒƒå›´
            if (dates.length > 0) {
                document.getElementById('dateRange').innerHTML = `${dates[0]} è‡³ ${dates[dates.length-1]}`;
            }
            document.getElementById('totalRecords').innerHTML = `${validCount}æ¡è®°å½•`;
            
            // ç”Ÿæˆæ—¥æœŸæŒ‰é’®
            generateDateButtons();
            
            // æ˜¾ç¤ºå…¨éƒ¨æ•°æ®
            showDate('all');
        }

        // ç”Ÿæˆæ—¥æœŸæŒ‰é’®
        function generateDateButtons() {
            const container = document.getElementById('dateButtons');
            container.innerHTML = '';
            
            // æ·»åŠ "å…¨éƒ¨æ—¥æœŸ"æŒ‰é’®
            const allBtn = document.createElement('button');
            allBtn.className = 'date-btn active';
            allBtn.onclick = () => showDate('all');
            allBtn.innerHTML = 'ğŸ“Š å…¨éƒ¨æ—¥æœŸç´¯è®¡';
            container.appendChild(allBtn);
            
            // ä¸ºæ¯ä¸ªæ—¥æœŸæ·»åŠ æŒ‰é’®
            dates.forEach(date => {
                const total = dailyData[date].reduce((a, b) => a + b, 0);
                const btn = document.createElement('button');
                btn.className = 'date-btn';
                btn.onclick = () => showDate(date);
                
                // æ ¼å¼åŒ–ä¸ºæ›´å‹å¥½çš„æ˜¾ç¤º
                const dateParts = date.split('-');
                const displayDate = `${dateParts[1]}/${dateParts[2]}`;
                btn.innerHTML = `${displayDate} (${total}æ¬¡)`;
                container.appendChild(btn);
            });
        }

        // è®¡ç®—ç´¯è®¡æ•°æ®
        function getTotalData() {
            const total = new Array(24).fill(0);
            dates.forEach(date => {
                for (let i = 0; i < 24; i++) {
                    total[i] += dailyData[date][i];
                }
            });
            return total;
        }

        // æ˜¾ç¤ºé€‰ä¸­çš„æ—¥æœŸ
        function showDate(date) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.date-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            let data, title;
            if (date === 'all') {
                data = getTotalData();
                const total = data.reduce((a, b) => a + b, 0);
                title = `ğŸ“Š å…¨éƒ¨æ—¥æœŸç´¯è®¡æˆæƒæ•°é‡ (æ€»è®¡: ${total}æ¬¡)`;
            } else {
                data = dailyData[date];
                const total = data.reduce((a, b) => a + b, 0);
                const dateParts = date.split('-');
                title = `ğŸ“… ${dateParts[0]}å¹´${dateParts[1]}æœˆ${dateParts[2]}æ—¥ æˆæƒæ•°é‡åˆ†å¸ƒ (æ€»è®¡: ${total}æ¬¡)`;
            }

            updateChart(data, title);
            updateStats(data);
        }

        // æ›´æ–°å›¾è¡¨
        function updateChart(data, title) {
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            const loadingEl = document.getElementById('loading');
            
            if (myChart) {
                myChart.destroy();
            }

            const maxValue = Math.max(...data);
            const avgValue = (data.reduce((a, b) => a + b, 0) / 24).toFixed(1);

            // éšè—åŠ è½½æç¤º
            loadingEl.style.display = 'none';

            // åˆ›å»ºæ¸å˜å¡«å……
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(74, 144, 226, 0.3)');
            gradient.addColorStop(1, 'rgba(74, 144, 226, 0.05)');

            const hours = Array.from({length: 24}, (_, i) => i + 'æ—¶');

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [
                        {
                            label: 'æˆæƒæ•°é‡',
                            data: data,
                            borderColor: '#4A90E2',
                            backgroundColor: gradient,
                            borderWidth: 3,
                            pointBackgroundColor: data.map(v => v === maxValue ? '#FF6B6B' : '#4A90E2'),
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: data.map(v => v === maxValue ? 8 : 5),
                            pointHoverRadius: 12,
                            pointHoverBackgroundColor: '#FF6B6B',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'å¹³å‡å€¼ ' + avgValue,
                            data: Array(24).fill(parseFloat(avgValue)),
                            borderColor: '#FFD93D',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            font: {
                                size: 18,
                                weight: 'bold',
                                family: 'Microsoft YaHei'
                            },
                            padding: { top: 10, bottom: 20 }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                label: function(context) {
                                    return context.raw + ' æ¬¡æˆæƒ';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                callback: value => value + 'æ¬¡'
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStats(data) {
            const total = data.reduce((a, b) => a + b, 0);
            const maxValue = Math.max(...data);
            const maxHour = data.indexOf(maxValue);
            const avg = (total / 24).toFixed(1);

            document.getElementById('totalCount').textContent = total;
            document.getElementById('peakHour').textContent = maxHour + 'æ—¶';
            document.getElementById('peakCount').textContent = maxValue;
            document.getElementById('avgCount').textContent = avg;
        }
    </script>
</body>
</html>


